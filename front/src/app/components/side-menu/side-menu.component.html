<!-- Reusable Templates -->

<!-- Logo Template -->
<ng-template #logoTemplate>
  <div class="menu-logo">
    <img
      ngSrc="/images/logo.png"
      alt="Logo"
      width="40"
      height="40"
      [style]="{ 'border-radius': '8px' }"
    />
    <span class="logo-text font-bold">KickStream</span>
  </div>
</ng-template>

<!-- Menu Items Template -->
<ng-template #menuItemsTemplate>
  @for (item of topMenuItems; track item) {
    <div
      class="nav-item"
      [routerLink]="item.route"
      routerLinkActive="active"
      [class.has-submenu]="item.hasChildren"
    >
      <div class="content">
        <i [class]="item.icon"></i>
        <span class="label">{{ item.label }}</span>
        @if (item.hasChildren) {
          <i
            class="pi angle-icon"
            [class.pi-angle-down]="!item.active"
            [class.pi-angle-up]="item.active"
            (click)="$event.stopPropagation(); item.active = !item.active"
          ></i>
        }
        @if (item.badge) {
          <div class="badge">{{ item.badge }}</div>
        }
      </div>
      @if (item.hasChildren && item.active) {
        <div class="submenu">
          @for (child of item.children; track child) {
            <div
              class="nav-item"
              [routerLink]="child.route"
              routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }"
            >
              <div class="content">
                <i [class]="child.icon"></i>
                <span class="label">{{ child.label }}</span>
                @if (child.badge) {
                  <div class="badge">{{ child.badge }}</div>
                }
              </div>
            </div>
          }
        </div>
      }
    </div>
  }
</ng-template>

<!-- Bottom Menu Items Template -->
<ng-template #bottomMenuItemsTemplate>
  @for (item of bottomMenuItems; track $index) {
    <div class="nav-item" [routerLink]="item.route" routerLinkActive="active">
      <div class="content">
        <i [class]="item.icon"></i>
        <span class="label">{{ item.label }}</span>
        @if (item.badge) {
          <div class="badge">{{ item.badge }}</div>
        }
      </div>
    </div>
  }
</ng-template>

<!-- Auth Buttons Template -->
<ng-template #authButtonsTemplate>
  @for (item of authMenuItems; track item) {
    <div
      class="nav-item auth-item"
      [routerLink]="item.route"
      routerLinkActive="active"
    >
      <div class="content">
        <i [class]="item.icon"></i>
        <span class="label">{{ item.label }}</span>
      </div>
    </div>
  }
</ng-template>

<!-- User Profile Template -->
<ng-template #userProfileTemplate let-profile="profile">
  <div class="user-profile-wrapper">
    <img
      class="profile-avatar"
      [src]="profile?.imgUrl | imageDefault"
      alt="Profile"
    />
    <div class="profile-info-text">
      <div class="profile-name">
        {{ profile?.firstName }} {{ profile?.lastName }}
      </div>
      <div class="profile-email">{{ profile?.email }}</div>
    </div>
  </div>
</ng-template>

<!-- Logout Button Template -->
<ng-template #logoutTemplate>
  <div class="nav-item logout-item" (click)="onLogout()">
    <div class="content">
      <i class="pi pi-sign-out"></i>
      <span class="label">Sign Out</span>
    </div>
  </div>
</ng-template>

<!-- Mobile Menu Toggle Button -->
<button
  [class.menu-open]="isMenuOpen()"
  class="toggle-menu-btn mobile-only"
  (click)="toggleMenu()"
>
  <i class="pi pi-bars"></i>
</button>

<!-- Desktop Top Menubar (visible on large screens) -->
<div class="desktop-menubar">
  <div class="menubar-container">
    <div class="menubar-start">
      <ng-container *ngTemplateOutlet="logoTemplate"></ng-container>
    </div>

    <div class="menubar-center">
      <div class="menubar-items">
        <!-- Menu Group -->
        <div class="menu-group" [class.expanded]="isTopMenuExpanded()">
          <div class="menu-group-trigger" (click)="toggleTopMenu()">
            <i class="pi pi-th-large"></i>
            <span class="label">Menu</span>
            <i class="pi pi-angle-down expand-icon"></i>
          </div>
          @if (isTopMenuExpanded()) {
            <div class="menu-dropdown">
              <ng-container
                *ngTemplateOutlet="menuItemsTemplate"
              ></ng-container>
            </div>
          }
        </div>

        @if (isAuthenticated()) {
          <!-- More Group -->
          <div class="menu-group" [class.expanded]="isBottomMenuExpanded()">
            <div class="menu-group-trigger" (click)="toggleBottomMenu()">
              <i class="pi pi-ellipsis-h"></i>
              <span class="label">More</span>
              <i class="pi pi-angle-down expand-icon"></i>
            </div>
            @if (isBottomMenuExpanded()) {
              <div class="menu-dropdown">
                <ng-container
                  *ngTemplateOutlet="bottomMenuItemsTemplate"
                ></ng-container>
              </div>
            }
          </div>
        }
      </div>
    </div>

    <div class="menubar-end">
      @if (!isAuthenticated()) {
        <div
          class="menu-group auth-menu-group"
          [class.expanded]="isAuthMenuExpanded()"
        >
          <div class="menu-group-trigger" (click)="toggleAuthMenu()">
            <i class="pi pi-user"></i>
            <span class="label">Account</span>
            <i class="pi pi-angle-down expand-icon"></i>
          </div>
          @if (isAuthMenuExpanded()) {
            <div class="menu-dropdown">
              <ng-container
                *ngTemplateOutlet="authButtonsTemplate"
              ></ng-container>
            </div>
          }
        </div>
      } @else {
        @let userProfile = authService.currentUser();
        <div class="menubar-user-section">
          <app-user-stats context="desktop"></app-user-stats>
          <div class="menubar-profile">
            <ng-container
              *ngTemplateOutlet="
                userProfileTemplate;
                context: { profile: userProfile }
              "
            ></ng-container>
          </div>
          <button class="menubar-logout-btn" (click)="onLogout()">
            <i class="pi pi-sign-out"></i>
          </button>
        </div>
      }
    </div>
  </div>
</div>

<!-- Mobile Drawer (visible on small screens) -->
<p-drawer
  [(visible)]="isMenuOpen"
  position="left"
  [modal]="true"
  [style]="{ width: '280px' }"
  styleClass="mobile-drawer"
>
  <div class="drawer-header">
    <ng-container *ngTemplateOutlet="logoTemplate"></ng-container>
  </div>

  <div class="top-section">
    <div class="top-items">
      <!-- Regular menu items -->
      <ng-container *ngTemplateOutlet="menuItemsTemplate"></ng-container>

      <!-- Auth menu items for non-authenticated users -->
      @if (!isAuthenticated()) {
        <ng-container *ngTemplateOutlet="authButtonsTemplate"></ng-container>
      } @else {
        <!-- Logout option for authenticated users -->
        <ng-container *ngTemplateOutlet="logoutTemplate"></ng-container>
      }
    </div>
  </div>

  @if (isAuthenticated()) {
    <div class="bottom-section">
      <div class="bottom-items">
        <ng-container
          *ngTemplateOutlet="bottomMenuItemsTemplate"
        ></ng-container>
      </div>
      @let userProfile = authService.currentUser();
      <!-- Profile section only for authenticated users -->
      @if (userProfile) {
        <div class="profile">
          <div class="profile-info">
            <ng-container
              *ngTemplateOutlet="
                userProfileTemplate;
                context: { profile: userProfile }
              "
            ></ng-container>
            <div class="profile-actions">
              <app-user-stats context="mobile"></app-user-stats>
            </div>
          </div>
        </div>
      }
    </div>
  }
</p-drawer>

<div class="overlay" [class.active]="isMenuOpen()" (click)="toggleMenu()"></div>
