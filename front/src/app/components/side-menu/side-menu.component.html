<button
  [class.menu-open]="isMenuOpen()"
  class="toggle-menu-btn"
  (click)="toggleMenu()"
>
  <i class="pi pi-bars"></i>
</button>

<p-drawer
  [(visible)]="isMenuOpen"
  position="left"
  [modal]="true"
  [style]="{ width: '280px' }"
>
  <div class="drawer-header">
    <img
      ngSrc="/images/logo.png"
      alt="Logo"
      width="64"
      height="64"
      [style]="{
        'border-radius': '12px'
      }"
    />
    <span class="logo-text font-bold">KickStream</span>
  </div>

  <div class="top-section">
    <div class="top-items">
      <!-- Regular menu items -->
      <div
        *ngFor="let item of topMenuItems"
        class="nav-item"
        [routerLink]="item.route"
        routerLinkActive="active"
        [class.has-submenu]="item.hasChildren"
      >
        <div class="content">
          <i [class]="item.icon"></i>
          <span class="label">{{ item.label }}</span>
          <i
            *ngIf="item.hasChildren"
            class="pi angle-icon"
            [class.pi-angle-down]="!item.active"
            [class.pi-angle-up]="item.active"
            (click)="$event.stopPropagation(); item.active = !item.active"
          ></i>
          <div *ngIf="item.badge" class="badge">{{ item.badge }}</div>
        </div>
        <div *ngIf="item.hasChildren && item.active" class="submenu">
          <div
            *ngFor="let child of item.children"
            class="nav-item"
            [routerLink]="child.route"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
          >
            <div class="content">
              <i [class]="child.icon"></i>
              <span class="label">{{ child.label }}</span>
              <div *ngIf="child.badge" class="badge">{{ child.badge }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Auth menu items for non-authenticated users -->
      @if (!(isAuthenticated|async)) { @for (item of authMenuItems; track
      $index) {
      <div class="nav-item" [routerLink]="item.route" routerLinkActive="active">
        <div class="content">
          <i [class]="item.icon"></i>
          <span class="label">{{ item.label }}</span>
        </div>
      </div>
      } } @else {
      <!-- Logout option for authenticated users -->
      <div class="nav-item" (click)="onLogout()">
        <div class="content">
          <i class="pi pi-sign-out"></i>
          <span class="label">Sign Out</span>
        </div>
      </div>
      }
    </div>
  </div>

  @if (isAuthenticated|async) {
  <div class="bottom-section">
    <div class="bottom-items">
      @for (item of bottomMenuItems; track $index) {
      <div class="nav-item" [routerLink]="item.route" routerLinkActive="active">
        <div class="content">
          <i [class]="item.icon"></i>
          <span class="label">{{ item.label }}</span>
          @if (item.badge) {
          <div class="badge">{{ item.badge }}</div>
          }
        </div>
      </div>
      }
    </div>
    @let userProfile = authService.currentUser$ | async;
    <!-- Profile section only for authenticated users -->
    @if (userProfile) {
    <div class="profile">
      <div class="profile-info">
        <img
          class="profile-picture"
          width="40"
          height="40"
          [ngSrc]="userProfile.imgUrl | imageDefault"
          alt="Profile Picture"
        />
        <div class="profile-details">
          <div class="profile-name">
            {{ userProfile.firstName }} {{ userProfile.lastName }}
          </div>
          <div class="profile-email">{{ userProfile.email }}</div>
          <div class="diamonds-display">
            <i class="pi pi-star"></i>
            <span>{{ diamonds() }} Diamonds</span>
          </div>
        </div>
      </div>
    </div>
    }
  </div>
  }
</p-drawer>

<div class="overlay" [class.active]="isMenuOpen()" (click)="toggleMenu()"></div>
