<p-dialog
  [(visible)]="visible"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="score-prediction-dialog"
  (onHide)="onHide()"
>
  <ng-template pTemplate="header">
    <h3>
      {{
        predictionDataSignal().isUpdating
          ? "Update Prediction"
          : "Score Prediction"
      }}
    </h3>
  </ng-template>

  <form [formGroup]="predictionForm" (ngSubmit)="onSubmit()">
    <div class="prediction-container">
      <!-- Team 1 -->
      <div class="team-section">
        <div class="team-header">
          @if ( team1Flag()) {
          <img
            [src]="team1Flag()"
            [alt]="team1Name() + ' flag'"
            class="team-flag"
          />}
          <h4 class="team-name">{{ team1Name() }}</h4>
        </div>
        <div class="score-input-container">
          <p-floatLabel>
            <input
              id="team1-score"
              type="number"
              pInputText
              formControlName="team1Score"
              [value]="predictionForm.get('team1Score')?.value"
              min="0"
              max="99"
              class="w-full"
            />
            <label for="team1-score">Score</label>
          </p-floatLabel>
        </div>
      </div>

      <!-- VS Divider -->
      <div class="vs-divider">
        <span class="vs-text">VS</span>
      </div>

      <!-- Team 2 -->
      <div class="team-section">
        <div class="team-header">
          @if ( team2Flag()) {
          <img
            [src]="team2Flag()"
            [alt]="team2Name() + ' flag'"
            class="team-flag"
          />
          }
          <h4 class="team-name">{{ team2Name() }}</h4>
        </div>
        <div class="score-input-container">
          <p-floatLabel>
            <input
              id="team2-score"
              type="number"
              pInputText
              formControlName="team2Score"
              [value]="predictionForm.get('team2Score')?.value"
              min="0"
              max="99"
              class="w-full"
            />
            <label for="team2-score">Score</label>
          </p-floatLabel>
        </div>
      </div>
    </div>

    <!-- Number of Diamonds -->
    <div class="diamonds-section">
      <p-floatLabel>
        <p-iconField iconPosition="left">
          <p-inputIcon styleClass="pi pi-diamond" />
          <input
            id="diamonds-input"
            type="number"
            pInputText
            formControlName="numberOfDiamonds"
            [value]="predictionForm.get('numberOfDiamonds')?.value"
            min="1"
            class="w-full"
          />
        </p-iconField>
        <label for="diamonds-input">Number of Diamonds</label>
      </p-floatLabel>
      @if
      (predictionForm.get('numberOfDiamonds')?.hasError('insufficientDiamonds')
      && predictionForm.get('numberOfDiamonds')?.touched) {
      <small class="error-message"
        >You don't have enough diamonds to bet this amount.</small
      >
      } @if (predictionForm.get('numberOfDiamonds')?.hasError('invalidDiamond')
      && predictionForm.get('numberOfDiamonds')?.touched) {
      <small class="error-message"
        >Unable to verify diamond amount. Please try again.</small
      >
      }
      <!--- @if (predictionForm.get('numberOfDiamonds')?.pending) {
      <small class="validating-message">Validating...</small>
    }-->
    </div>

    <!-- Match Validation Errors -->
    @if (predictionForm.hasError('matchNotAvailableForBet')) {
    <div class="match-error-section">
      <small class="error-message">
        <i class="pi pi-exclamation-triangle"></i>
        This match has already begun. Predictions are no longer available.
      </small>
    </div>
    } @if (predictionForm.hasError('invalidMatch')) {
    <div class="match-error-section">
      <small class="error-message">
        <i class="pi pi-exclamation-triangle"></i>
        Unable to verify match status. Please try again.
      </small>
    </div>
    }
    <div class="dialog-footer">
      <p-button
        label="Cancel"
        icon="pi pi-times"
        (onClick)="onCancel()"
        [outlined]="true"
        severity="secondary"
      />
      <p-button
        [label]="
          predictionDataSignal().isUpdating
            ? 'Update Prediction'
            : 'Submit Prediction'
        "
        icon="pi pi-check"
        type="submit"
        severity="success"
        [disabled]="predictionForm.invalid || predictionForm.pending"
      />
    </div>
  </form>
</p-dialog>
